type std.Error:
  message: String

type User:
  id: Id
  email: Email
  age: Int(0..10)

fn ok_user() -> User!std.Error:
  let raw = json.decode("{\"id\":\"user-1\",\"email\":\"a@b.com\",\"age\":5}")
  return User(id=raw["id"], email=raw["email"], age=raw["age"])

fn bad_id() -> User!std.Error:
  let raw = json.decode("{\"id\":\"\",\"email\":\"a@b.com\",\"age\":5}")
  return User(id=raw["id"], email=raw["email"], age=raw["age"])

fn bad_email() -> User!std.Error:
  let raw = json.decode("{\"id\":\"user-1\",\"email\":\"bad\",\"age\":5}")
  return User(id=raw["id"], email=raw["email"], age=raw["age"])

fn bad_age() -> User!std.Error:
  let raw = json.decode("{\"id\":\"user-1\",\"email\":\"a@b.com\",\"age\":20}")
  return User(id=raw["id"], email=raw["email"], age=raw["age"])

fn show(label: String, result: User!std.Error):
  match result:
    Ok(u):
      print("${label}: ok ${u}")
    Err(e):
      print("${label}: ${e.message}")
      print(json.encode(e.fields))

app "demo":
  show("ok_user", ok_user())
  show("bad_id", bad_id())
  show("bad_email", bad_email())
  show("bad_age", bad_age())
