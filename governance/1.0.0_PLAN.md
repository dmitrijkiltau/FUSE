# FUSE 1.0.0 Stability Plan

Status: Active (`M2` + `M3` complete, `M4` wiring complete, `M7`-`M10` hardening complete, `M5` ongoing, `M6` pending)  
Source contract: `spec/1.0.0_STABILITY_CONTRACT.md`

This plan defines milestones to satisfy all `v1.0.0` entry criteria and keep docs clean during
execution and at release cut.

## Execution rules

1. Contract-facing code changes and doc updates ship in the same PR.
2. Each milestone must leave the repo in a green gate state for affected suites.
3. Non-goals in the stability contract remain enforced unless maintainers explicitly revise scope.

## Execution order

The milestone numbers are historical IDs. Delivery sequence for `v0.7.0` -> `v1.0.0` is:

1. Baseline + frozen-surface + wiring: `M0` -> `M4`
2. AOT production hardening (new focus): `M7` -> `M10`
3. Continuous docs sync + final sweep: `M5`
4. Release-candidate acceptance: `M6`

## Milestone status (as of 2026-02-28)

| Milestone | Status | Notes |
|---|---|---|
| `M0` | Pending | Tracking artifacts still need to be formalized as deliverables. |
| `M1` | In progress | Contract-test coverage was expanded during `v0.6.0` work (capabilities, typed error domains, structured concurrency, transaction semantics, strict-architecture checks, and new request/response HTTP primitives); remaining frozen-surface coverage still needs closure. |
| `M2` | Complete | `examples/reference-service/` is now the canonical package-level service example with auth + CRUD + migrations + OpenAPI + strict-architecture compatibility, and package workflows/docs point to it. |
| `M3` | Complete | Observability baseline contract + runtime plumbing + tests/docs are in place (request IDs, structured request logs, panic taxonomy, metrics hook). |
| `M4` | Complete (wiring) | CLI default wiring is complete: `fuse build --release` now defaults to AOT output; explicit non-AOT path remains `fuse build`; docs/tooling/tests were updated. |
| `M7` | Complete | AOT runtime contract hardening is complete: runtime contract text is explicit and test-backed (startup order, metadata determinism, config precedence, no hidden startup execution path, AOT request-id/log consistency, unix signal semantics, explicit panic-path envelope/exit semantics). |
| `M8` | Complete | Production ergonomics layer is complete: canonical `/health` pattern documented, startup log format frozen, optional release structured-log default wired, deterministic graceful signal handling landed, and runtime plugin system declared explicit non-goal. |
| `M9` | Complete | Deployment surface formalization is complete: official release-artifact-based GHCR image path is defined/wired, canonical minimal production Dockerfile is in-tree, and single-page deploy guide covers VM/Docker/systemd/Kubernetes patterns. |
| `M10` | Complete | AOT parity lock is complete: authority parity gates now explicitly cover AST/native/AOT observable-equivalence surfaces (errors/envelopes, JSON, logging, panic taxonomy, transaction rollback, `spawn`/`await`) with deterministic divergence diagnostics. |
| `M5` | Ongoing | Continuous milestone across all PRs; final documentation sweep runs after `M10` and before `M6`. |
| `M6` | Pending | Release-candidate gate run and acceptance update are pending after hardening + final docs sweep. |

`M2` gate evidence captured on 2026-02-28:

1. `./scripts/semantic_suite.sh` (`PASS`)
2. `./scripts/authority_parity.sh` (`PASS`)
3. `./scripts/lsp_suite.sh` (`PASS`)
4. `./scripts/reliability_repeat.sh --iterations 2` (`PASS`; local sandbox run failed only due host bind restrictions, rerun outside sandbox passed)
5. `./scripts/check_aot_perf_slo.sh` (`PASS`)
6. `./scripts/packaging_verifier_regression.sh` (`PASS`)
7. `./scripts/fuse check --manifest-path examples/reference-service --strict-architecture` (`PASS`)
8. `./scripts/use_case_bench.sh` (`PASS`)

`M3` gate evidence captured on 2026-02-28:

1. `scripts/cargo_env.sh cargo test -p fusec` (`PASS`; includes observability runtime coverage)
2. `scripts/cargo_env.sh cargo test -p fuse --test project_cli` (`PASS`; includes AOT panic taxonomy wiring coverage)
3. `./scripts/generate_guide_docs.sh` (`PASS`; docs reference regenerated after runtime/spec updates)

`M4` gate evidence captured on 2026-02-28:

1. `scripts/cargo_env.sh cargo test -p fuse --test project_cli` (`PASS`; includes default-AOT + explicit non-AOT path coverage)
2. `./scripts/generate_guide_docs.sh` (`PASS`; docs/tooling references regenerated for `--release` default-AOT behavior)

`M7` gate evidence captured on 2026-02-28:

1. `scripts/cargo_env.sh cargo test -p fuse --test project_cli` (`PASS`; includes startup order, metadata determinism, config precedence, request-id/log consistency, unix signal semantics, and explicit panic-path `exit=101` + `class=panic` coverage)
2. `./scripts/generate_guide_docs.sh` (`PASS`; runtime/spec references regenerated after AOT runtime contract updates)

`M8` gate evidence captured on 2026-02-28:

1. `scripts/cargo_env.sh cargo test -p fuse --test project_cli` (`PASS`; includes startup-line format contract, optional release structured-log default coverage, and deterministic graceful signal shutdown coverage)
2. `./scripts/generate_guide_docs.sh` (`PASS`; runtime/spec references regenerated after production ergonomics contract updates)

`M9` gate evidence captured on 2026-02-28:

1. `bash -n scripts/package_aot_container_image.sh` (`PASS`; release-artifact image packaging script is syntactically valid)
2. `./scripts/package_aot_container_image.sh --help` (`PASS`; deploy tooling entrypoint is wired/documented)
3. Docs + workflow alignment landed:
   - `ops/DEPLOY.md` (single-page deploy guide: VM, Docker, `systemd`, Kubernetes)
   - `ops/docker/AOT_MINIMAL.Dockerfile` (canonical minimal production Dockerfile)
   - `.github/workflows/release-artifacts.yml` (tagged release publishes `ghcr.io/dmitrijkiltau/fuse-aot-demo:<tag|sha>` from `fuse-aot-linux-x64.tar.gz`)

`M10` gate evidence captured on 2026-02-28:

1. `scripts/cargo_env.sh cargo test -p fuse --test aot_parity_lock` (`PASS`; explicit AST/native/AOT parity matrix for error mapping/envelopes, JSON encoding, logging semantics, transaction rollback behavior, and `spawn`/`await` behavior with backend-labeled diagnostics)
2. `scripts/cargo_env.sh cargo test -p fuse --test project_cli build_aot_runtime_panic_uses_exit_101_and_panic_fatal_envelope` (`PASS`; explicit AOT panic taxonomy contract: `exit=101`, `class=panic`)
3. `./scripts/authority_parity.sh` (`PASS`; parity gate sequence expanded to include M10 AST/native/AOT matrix + panic taxonomy checks)

## Milestones (Execution Sequence)

### Phase A: Baseline and wiring

### M0: Baseline audit and tracking

Deliverables:

1. Gap matrix mapping every contract criterion to current implementation status.
2. Ownership map for each criterion (compiler/runtime/tooling/docs).
3. Tracking checklist issue with links to milestone PRs.

Exit criteria:

1. All contract clauses are mapped to a concrete implementation task.
2. Blocking unknowns are resolved or explicitly deferred with owner/date.

### M1: Freeze semantics with contract tests

Deliverables:

1. Expand parser fixtures (`crates/fusec/tests/parser_fixtures.rs`) for frozen syntax cases.
2. Expand semantic golden tests (`crates/fusec/tests/sema_golden.rs`) for frozen static/runtime
   boundary behavior.
3. Add/update runtime tests for error envelope, status mapping, config precedence, JSON behavior,
   and dependency/lockfile determinism.

Exit criteria:

1. `./scripts/semantic_suite.sh` passes.
2. `./scripts/authority_parity.sh` passes.
3. No known AST/native/AOT contract-facing divergence remains open.

### M2: Canonical reference service

Deliverables:

1. Create `examples/reference-service/` with:
   - auth
   - CRUD
   - validation failure paths
   - DB migrations
   - deterministic `spawn` usage
   - structured logging mode
   - OpenAPI enabled route
2. Add service validation scripts/docs for run/test/build/AOT paths.
3. Produce deployable AOT artifact for the reference service.
4. Migrate all package-level example workflows from legacy canonical examples to
   `examples/reference-service/`.
5. Remove replaced canonical package examples after migration.
6. Remove redundant examples that duplicate covered behavior without adding unique contract value.

Exit criteria:

1. Reference service is used in CI/regression gates where appropriate.
2. Service passes semantic/parity/LSP/reliability/AOT/packaging checks.
3. No user-facing workflow points to removed canonical examples.
4. Remaining examples each have a unique scope statement in `examples/README.md`.

### M3: Observability baseline

Kickoff sequence (current):

1. Define observability contract in `spec/runtime.md`:
   - request ID propagation source/precedence and response emission rules
   - structured request logging mode and stable field set
   - deterministic panic classification taxonomy for fatal envelopes
   - metrics hook shape, guarantees, and non-goals
2. Add runtime tests for all contract clauses before implementation broadening.
3. Implement minimal runtime plumbing to satisfy contract and tests.
4. Update docs in the same PR (`README.md`, `guides/fuse.md`, `spec/runtime.md`).

Deliverables:

1. Request ID propagation for HTTP request lifecycle.
2. Optional structured request logging mode.
3. Deterministic panic classification aligned with fatal envelope contract.
4. Minimal metrics hook extension point (non-semantic).

Exit criteria:

1. Observability behavior is tested and documented.
2. No behavioral regression in existing logging/error paths.

### M4: AOT release-default behavior

Deliverables:

1. Implement `fuse build --release` => AOT by default.
2. Preserve non-AOT local development path and document explicit usage.
3. Update build/test/release tooling to reflect new default behavior.

Exit criteria:

1. CLI tests cover both default AOT and explicit non-AOT paths.
2. AOT metadata/fatal envelope contract remains unchanged.

### Phase B: AOT production hardening (`v0.7.0`)

### M7: AOT runtime contract hardening (`v0.7.0`)

Goal:

1. Freeze what an AOT binary guarantees at runtime (production contract), not just build behavior.

Deliverables:

1. Add a formal AOT runtime contract section in `spec/runtime.md` covering:
   - startup order guarantees
   - signal handling semantics
   - shutdown behavior
   - exit code contract
   - fatal envelope invariants
   - request ID + logging consistency guarantees
   - deterministic config resolution order
2. Add startup determinism tests for:
   - identical metadata across rebuilds with identical inputs
   - consistent environment precedence behavior
   - no hidden runtime side effects during startup
3. Make explicit in spec/docs:
   - no dynamic backend fallback in AOT
   - no JIT at AOT runtime
   - no runtime compilation in AOT binaries

Exit criteria:

1. Runtime contract text is explicit and non-ambiguous in `spec/runtime.md`.
2. Determinism tests are in-tree and green.
3. AOT runtime constraints are explicit user-facing guarantees, not implied behavior.

### M8: Production ergonomics layer (`v0.7.0`)

Goal:

1. Make production posture operationally clear by default.

Deliverables:

1. Define and document built-in `/health` convention (or canonical minimal pattern if non-built-in).
2. Freeze a stable startup log line format contract.
3. Define optional structured logging default posture for `--release`.
4. Implement and document deterministic graceful signal handling (`SIGTERM`, `SIGINT`).
5. Record explicit non-goal: no runtime plugin extension system.

Exit criteria:

1. Operational behavior is documented and test-backed where applicable.
2. Production guidance is canonical and consistent across runtime/docs/tooling.

### M9: Deployment surface formalization (`v0.7.0`)

Goal:

1. Make AOT deployment patterns canonical, minimal, and reproducible.

Deliverables:

1. Official Docker image path built from release artifacts.
2. Canonical minimal production Dockerfile in docs.
3. Single-page deploy guide covering:
   - VM
   - Docker
   - `systemd`
   - Kubernetes

Exit criteria:

1. Deployment documentation is actionable, minimal, and source-of-truth aligned.
2. Release tooling references canonical deploy patterns only.

### M10: AOT parity lock (`v0.7.0`)

Goal:

1. Tighten parity contract to assert AST/native/AOT observable equivalence for frozen surfaces.

Deliverables:

1. Expand parity gates to explicitly validate equivalence for:
   - error mapping/envelopes
   - JSON encoding behavior
   - logging output semantics
   - panic taxonomy behavior
   - transaction rollback semantics
   - `spawn`/`await` semantics
2. Add or tighten failing diagnostics when backend divergence is detected.

Exit criteria:

1. No known AST/native/AOT observable divergence remains for frozen contract surfaces.
2. Parity gates fail deterministically on backend-specific reinterpretation.

### Phase C: Documentation sweep and release acceptance

### M5: Documentation sync (continuous + final sweep)

Deliverables during each milestone PR:

1. Update impacted docs immediately, not post hoc.
2. Keep command examples and behavior statements aligned with actual CLI/runtime behavior.

Final sweep deliverables before `v1.0.0` tag:

1. Reconcile and update:
   - `README.md`
   - `guides/fuse.md`
   - `spec/fls.md`
   - `spec/runtime.md`
   - `governance/scope.md`
2. Regenerate docs site reference:
   - `./scripts/generate_guide_docs.sh`
   - verify `docs/site/specs/reference.md` is current
3. Run a repository trace check for removed canonical examples and clear all remaining references
   in docs/scripts/tests/benchmarks.

Exit criteria:

1. No contradictory contract statements across docs.
2. Release-facing docs reflect the accepted behavior and gates.
3. Removed canonical examples have no remaining references in active documentation/workflows.

### M6: Release candidate and acceptance

Deliverables:

1. Run full release gates:
   - `./scripts/semantic_suite.sh`
   - `./scripts/authority_parity.sh`
   - `./scripts/lsp_suite.sh`
   - `./scripts/reliability_repeat.sh --iterations 2`
   - `./scripts/check_aot_perf_slo.sh`
   - `./scripts/packaging_verifier_regression.sh`
   - `./scripts/release_smoke.sh`
2. Resolve or explicitly waive remaining issues with maintainer sign-off.
3. Update contract status from `Proposed` to `Accepted` at `v1.0.0`.

Exit criteria:

1. All gates pass on release candidate commit.
2. `spec/1.0.0_STABILITY_CONTRACT.md` is accepted and published with release notes.
