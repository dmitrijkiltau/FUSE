# FUSE Migration: 0.1.x -> 0.2.0

This guide covers required updates when moving from FUSE `0.1.x` to `0.2.0`.

## 1) Replace removed `task.*` helpers

Removed APIs:

- `task.id(...)`
- `task.done(...)`
- `task.cancel(...)`

`Task<T>` remains opaque. Use `spawn` + `await` only.

Before (`0.1.x`):

```fuse
let t = spawn:
  work()
if task.done(t):
  print(task.id(t))
```

After (`0.2.0`):

```fuse
let t = spawn:
  work()
let out = await t
print(out)
```

Compiler diagnostics now report removed methods with migration hints.

## 2) Update `spawn` blocks for determinism restrictions

Inside `spawn`, semantic analysis now rejects:

- `box` capture/use
- runtime side-effect builtins:
  - `db.*`
  - `serve`
  - `print`
  - `log`
  - `env`
  - `asset`
  - `svg.inline`
- mutation of captured outer bindings

Recommended migration pattern:

- keep side effects on the parent path
- use `spawn` for pure compute work
- return values and apply effects after `await`

## 3) Expect build cache invalidation

`program.meta` moved from schema v2 to v3. Cache validity now uses content hashes for:

- module graph source files
- `fuse.toml`
- `fuse.lock` (when present)

Existing `.fuse/build` artifacts from `0.1.x` are intentionally invalidated.

## 4) VS Code package format changed

Packaging now emits installable VSIX files:

- `dist/fuse-vscode-<platform>.vsix`

Install with:

```bash
code --install-extension dist/fuse-vscode-linux-x64.vsix
```

## 5) Release gate additions

`scripts/release_smoke.sh` now also enforces:

- benchmark collection (`scripts/use_case_bench.sh`)
- benchmark regression checks (`scripts/check_use_case_bench_regression.sh`)
- VSIX packaging/integrity validation (`scripts/package_vscode_extension.sh`)

## 6) CLI UX and automation output changes

If your scripts parse `fuse` stderr/stdout, update them for the v0.2.0 CLI contract:

- `fuse check|run|build|test` now emit stderr step markers:
  - `[check|run|build|test] start`
  - `[check|run|build|test] ok|failed|validation failed`
- CLI error/warning diagnostics now use normalized prefixes:
  - `error: ...`
  - `warning: ...`
- Program-arg validation failures in `fuse run -- ...` continue to return exit code `2`
  and emit JSON validation payloads on stderr.

Recommendation for deterministic CI logs:

- use `--color never` (or set `NO_COLOR=1`) when asserting text output
- keep `--color auto` for interactive terminal use
