{
  "name": "Fuse",
  "scopeName": "source.fuse",
  "patterns": [
    {"include": "#comments"},
    {"include": "#imports"},
    {"include": "#strings"},
    {"include": "#fnDefinitions"},
    {"include": "#definitions"},
    {"include": "#fields"},
    {"include": "#structLiterals"},
    {"include": "#functionCalls"},
    {"include": "#errorTypes"},
    {"include": "#keywords"},
    {"include": "#patternKeywords"},
    {"include": "#arrow"},
    {"include": "#generics"},
    {"include": "#types"},
    {"include": "#userTypes"},
    {"include": "#constants"},
    {"include": "#numbers"},
    {"include": "#operators"},
    {"include": "#namespaces"},
    {"include": "#memberAccess"}
  ],
  "repository": {
    "imports": {
      "patterns": [
        {
          "name": "meta.import.fuse",
          "begin": "^\\s*(import)\\b",
          "beginCaptures": {
            "1": {"name": "keyword.control.import.fuse"}
          },
          "end": "$",
          "patterns": [
            {
              "name": "keyword.control.fuse",
              "match": "\\b(from|as)\\b"
            },
            {
              "name": "punctuation.section.braces.fuse",
              "match": "[{},]"
            },
            {
              "name": "entity.name.type.fuse",
              "match": "\\b(?!import\\b|from\\b|as\\b)[A-Z][A-Za-z0-9_]*(?:\\.[A-Za-z_][A-Za-z0-9_]*)*\\b"
            },
            {
              "name": "entity.name.function.fuse",
              "match": "\\b(?!import\\b|from\\b|as\\b)[a-z_][A-Za-z0-9_]*\\b"
            },
            {
              "name": "string.quoted.double.fuse",
              "match": "\"[^\"]*\""
            },
            {
              "name": "constant.other.import-path.fuse",
              "match": "dep:[^\"\\s]+"
            }
          ]
        }
      ]
    },
    "comments": {
      "patterns": [
        {
          "name": "comment.block.documentation.fuse",
          "match": "##.*$"
        },
        {
          "name": "comment.line.number-sign.fuse",
          "match": "#.*$"
        }
      ]
    },
    "strings": {
      "patterns": [
        {
          "name": "string.quoted.double.fuse",
          "begin": "\"",
          "end": "\"",
          "beginCaptures": {
            "0": {"name": "punctuation.definition.string.begin.fuse"}
          },
          "endCaptures": {
            "0": {"name": "punctuation.definition.string.end.fuse"}
          },
          "patterns": [
            {
              "name": "constant.character.escape.fuse",
              "match": "\\\\[\\\\\"nrt$]"
            },
            {
              "name": "constant.character.escape.fuse",
              "match": "\\\\."
            },
            {
              "name": "constant.other.import-path.fuse",
              "match": "dep:[^\"\\s]+"
            },
            {
              "name": "meta.embedded.expression.fuse",
              "begin": "\\$\\{",
              "end": "\\}",
              "beginCaptures": {
                "0": {"name": "punctuation.section.embedded.begin.fuse"}
              },
              "endCaptures": {
                "0": {"name": "punctuation.section.embedded.end.fuse"}
              },
              "patterns": [
                {"include": "#functionCalls"},
                {"include": "#keywords"},
                {"include": "#types"},
                {"include": "#userTypes"},
                {"include": "#constants"},
                {"include": "#numbers"},
                {"include": "#operators"},
                {"include": "#strings"},
                {"include": "#memberAccess"}
              ]
            }
          ]
        }
      ]
    },
    "keywords": {
      "patterns": [
        {
          "name": "keyword.control.fuse",
          "match": "\\b(if|else|match|for|in|while|break|continue|return|import|from|as|spawn|await)\\b"
        },
        {
          "name": "keyword.declaration.fuse",
          "match": "\\b(fn|type|enum|config|service|app|migration|table|test)\\b"
        },
        {
          "name": "keyword.other.fuse",
          "match": "\\b(let|var|body|without|box|at)\\b"
        },
        {
          "name": "keyword.other.http-verb.fuse",
          "match": "^\\s*(get|post|put|patch|delete)\\b"
        },
        {
          "name": "keyword.operator.logical.fuse",
          "match": "\\b(and|or)\\b"
        }
      ]
    },
    "patternKeywords": {
      "patterns": [
        {
          "name": "constant.language.pattern.fuse",
          "match": "\\b(Ok|Err|Some|None)\\b"
        },
        {
          "name": "constant.language.wildcard.fuse",
          "match": "\\b_\\b"
        }
      ]
    },
    "fnDefinitions": {
      "patterns": [
        {
          "name": "meta.definition.function.fuse",
          "match": "^\\s*(fn)\\s+([A-Za-z_][A-Za-z0-9_]*(?:\\.[A-Za-z_][A-Za-z0-9_]*)*)",
          "captures": {
            "1": {"name": "keyword.declaration.fuse"},
            "2": {"name": "entity.name.function.fuse"}
          }
        }
      ]
    },
    "definitions": {
      "patterns": [
        {
          "name": "meta.definition.fuse",
          "match": "^\\s*(type|enum|config|migration|table)\\s+([A-Za-z_][A-Za-z0-9_]*(?:\\.[A-Za-z_][A-Za-z0-9_]*)*)",
          "captures": {
            "1": {"name": "keyword.declaration.fuse"},
            "2": {"name": "entity.name.type.fuse"}
          }
        },
        {
          "name": "meta.definition.service.fuse",
          "match": "^\\s*(service)\\s+([A-Za-z_][A-Za-z0-9_]*)\\s+(at)\\s+(\"[^\"]*\")",
          "captures": {
            "1": {"name": "keyword.declaration.fuse"},
            "2": {"name": "entity.name.type.fuse"},
            "3": {"name": "keyword.other.fuse"},
            "4": {"name": "string.quoted.double.fuse"}
          }
        },
        {
          "name": "meta.definition.app.fuse",
          "match": "^\\s*(app)\\s+(\"[^\"]*\")",
          "captures": {
            "1": {"name": "keyword.declaration.fuse"},
            "2": {"name": "string.quoted.double.fuse"}
          }
        },
        {
          "name": "meta.definition.test.fuse",
          "match": "^\\s*(test)\\s+(\"[^\"]*\")",
          "captures": {
            "1": {"name": "keyword.declaration.fuse"},
            "2": {"name": "string.quoted.double.fuse"}
          }
        }
      ]
    },
    "fields": {
      "patterns": [
        {
          "name": "meta.field.fuse",
          "match": "^\\s*([a-z_][A-Za-z0-9_]*)\\s*:",
          "captures": {
            "1": {"name": "variable.other.property.fuse"}
          }
        }
      ]
    },
    "structLiterals": {
      "patterns": [
        {
          "name": "meta.struct-literal.fuse",
          "match": "\\b([A-Z][A-Za-z0-9_]*(?:\\.[A-Z][A-Za-z0-9_]*)*)\\s*(\\()",
          "captures": {
            "1": {"name": "entity.name.type.fuse"},
            "2": {"name": "punctuation.section.arguments.begin.fuse"}
          }
        }
      ]
    },
    "functionCalls": {
      "patterns": [
        {
          "name": "meta.function-call.fuse",
          "match": "\\b([a-z_][A-Za-z0-9_]*(?:\\.[A-Za-z_][A-Za-z0-9_]*)*)\\s*(\\()",
          "captures": {
            "1": {"name": "entity.name.function.fuse"},
            "2": {"name": "punctuation.section.arguments.begin.fuse"}
          }
        }
      ]
    },
    "errorTypes": {
      "patterns": [
        {
          "name": "meta.error-type.fuse",
          "match": "!\\s*([A-Za-z_][A-Za-z0-9_]*(?:\\.[A-Za-z_][A-Za-z0-9_]*)*)",
          "captures": {
            "0": {"name": "keyword.operator.fuse"},
            "1": {"name": "support.type.error.fuse"}
          }
        }
      ]
    },
    "arrow": {
      "patterns": [
        {
          "name": "keyword.operator.arrow.fuse",
          "match": "->"
        }
      ]
    },
    "generics": {
      "patterns": [
        {
          "name": "meta.generic.fuse",
          "begin": "\\b(List|Map|Option|Result|Task|Range)\\s*(<)",
          "beginCaptures": {
            "1": {"name": "entity.name.type.fuse"},
            "2": {"name": "punctuation.definition.typeparameters.begin.fuse"}
          },
          "end": "(>)",
          "endCaptures": {
            "1": {"name": "punctuation.definition.typeparameters.end.fuse"}
          },
          "patterns": [
            {"include": "#generics"},
            {
              "name": "support.type.builtin.fuse",
              "match": "\\b(Int|Float|Bool|String|Id|Email|Bytes|Error|Unit)\\b"
            },
            {"include": "#userTypes"},
            {"include": "#numbers"},
            {
              "name": "punctuation.separator.comma.fuse",
              "match": ","
            }
          ]
        }
      ]
    },
    "operators": {
      "patterns": [
        {
          "name": "keyword.operator.optional-chaining.fuse",
          "match": "\\?\\."
        },
        {
          "name": "keyword.operator.bang-chain.fuse",
          "match": "\\?!"
        },
        {
          "name": "keyword.operator.coalesce.fuse",
          "match": "\\?\\?"
        },
        {
          "name": "keyword.operator.arrow.fuse",
          "match": "->"
        },
        {
          "name": "keyword.operator.fat-arrow.fuse",
          "match": "=>"
        },
        {
          "name": "keyword.operator.range.fuse",
          "match": "\\.\\."
        },
        {
          "name": "keyword.operator.comparison.fuse",
          "match": "==|!=|<=|>="
        },
        {
          "name": "keyword.operator.comparison.fuse",
          "match": "(?<!-)>"
        },
        {
          "name": "keyword.operator.comparison.fuse",
          "match": "<"
        },
        {
          "name": "keyword.operator.assignment.fuse",
          "match": "(?<![=!<>])=(?!=)"
        },
        {
          "name": "keyword.operator.arithmetic.fuse",
          "match": "-(?!>)|[+*/%]"
        },
        {
          "name": "keyword.operator.optional.fuse",
          "match": "\\?"
        },
        {
          "name": "keyword.operator.bang.fuse",
          "match": "!"
        }
      ]
    },
    "types": {
      "patterns": [
        {
          "name": "support.type.builtin.fuse",
          "match": "\\b(Int|Float|Bool|String|Id|Email|Bytes|Error|Unit)\\b"
        },
        {
          "name": "support.type.generic.fuse",
          "match": "\\b(Option|Result|List|Map|Task|Range)\\b"
        }
      ]
    },
    "userTypes": {
      "patterns": [
        {
          "name": "support.type.user.fuse",
          "match": "\\b[A-Z][A-Za-z0-9_]*\\b"
        }
      ]
    },
    "constants": {
      "patterns": [
        {
          "name": "constant.language.fuse",
          "match": "\\b(true|false|null)\\b"
        }
      ]
    },
    "numbers": {
      "patterns": [
        {
          "name": "constant.numeric.float.fuse",
          "match": "\\b\\d+\\.\\d+\\b"
        },
        {
          "name": "constant.numeric.integer.fuse",
          "match": "\\b\\d+\\b"
        }
      ]
    },
    "namespaces": {
      "patterns": [
        {
          "match": "(?:^\\s*(?:type|enum|config)\\s+|[:!]|->)\\s*([A-Za-z_][A-Za-z0-9_]*)(?=\\.)",
          "captures": {
            "1": {"name": "entity.name.namespace.fuse"}
          }
        },
        {
          "match": "\\b(?:List|Map|Option|Result|Task|Range)\\s*<\\s*([A-Za-z_][A-Za-z0-9_]*)(?=\\.)",
          "captures": {
            "1": {"name": "entity.name.namespace.fuse"}
          }
        },
        {
          "match": "\\b([A-Za-z_][A-Za-z0-9_]*)(?=\\.[A-Za-z_][A-Za-z0-9_]*\\s*\\()",
          "captures": {
            "1": {"name": "entity.name.namespace.fuse"}
          }
        }
      ]
    },
    "memberAccess": {
      "patterns": [
        {
          "name": "meta.member-call.fuse",
          "match": "(?<=\\??\\.)([A-Za-z_][A-Za-z0-9_]*)(?=\\s*\\()",
          "captures": {
            "0": {"name": "entity.name.function.fuse"}
          }
        },
        {
          "name": "meta.member.fuse",
          "match": "(?<=\\??\\.)([A-Za-z_][A-Za-z0-9_]*)",
          "captures": {
            "0": {"name": "variable.other.property.fuse"}
          }
        }
      ]
    }
  }
}
