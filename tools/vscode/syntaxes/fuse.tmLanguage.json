{
  "name": "Fuse",
  "scopeName": "source.fuse",
  "patterns": [
    {"include": "#comments"},
    {"include": "#imports"},
    {"include": "#strings"},
    {"include": "#definitions"},
    {"include": "#fields"},
    {"include": "#functionCalls"},
    {"include": "#errorTypes"},
    {"include": "#keywords"},
    {"include": "#types"},
    {"include": "#userTypes"},
    {"include": "#constants"},
    {"include": "#numbers"},
    {"include": "#namespaces"},
    {"include": "#memberAccess"}
  ],
  "repository": {
    "imports": {
      "patterns": [
        {
          "name": "meta.import.fuse",
          "begin": "^\\s*(import)\\b",
          "beginCaptures": {
            "1": {"name": "keyword.control.fuse"}
          },
          "end": "$",
          "patterns": [
            {
              "name": "keyword.control.fuse",
              "match": "\\b(from|as)\\b"
            },
            {
              "name": "punctuation.section.braces.fuse",
              "match": "[{},]"
            },
            {
              "name": "entity.name.type.fuse",
              "match": "\\b(?!import\\b|from\\b|as\\b)[A-Za-z_][A-Za-z0-9_]*(?:\\.[A-Za-z_][A-Za-z0-9_]*)*\\b"
            },
            {
              "name": "string.quoted.double.fuse",
              "match": "\"[^\"]*\""
            },
            {
              "name": "constant.other.import-path.fuse",
              "match": "dep:[^\"\\s]+"
            }
          ]
        }
      ]
    },
    "comments": {
      "patterns": [
        {
          "name": "comment.line.double-hash.fuse",
          "match": "##.*$"
        },
        {
          "name": "comment.line.number-sign.fuse",
          "match": "#.*$"
        }
      ]
    },
    "strings": {
      "patterns": [
        {
          "name": "string.quoted.double.fuse",
          "begin": "\"",
          "end": "\"",
          "beginCaptures": {
            "0": {"name": "punctuation.definition.string.begin.fuse"}
          },
          "endCaptures": {
            "0": {"name": "punctuation.definition.string.end.fuse"}
          },
          "patterns": [
            {
              "name": "constant.character.escape.fuse",
              "match": "\\\\(\\\\|\"|n|r|t)"
            },
            {
              "name": "constant.character.escape.fuse",
              "match": "\\\\."
            },
            {
              "name": "constant.other.import-path.fuse",
              "match": "dep:[^\"\\s]+"
            },
            {
              "name": "meta.embedded.expression.fuse",
              "begin": "\\$\\{",
              "end": "\\}",
              "beginCaptures": {
                "0": {"name": "punctuation.section.embedded.begin.fuse"}
              },
              "endCaptures": {
                "0": {"name": "punctuation.section.embedded.end.fuse"}
              },
              "patterns": [
                {"include": "#keywords"},
                {"include": "#types"},
                {"include": "#constants"},
                {"include": "#numbers"},
                {"include": "#strings"}
              ]
            }
          ]
        }
      ]
    },
    "keywords": {
      "patterns": [
        {
          "name": "keyword.control.fuse",
          "match": "\\b(app|service|at|get|post|put|patch|delete|fn|type|enum|let|var|return|if|else|match|for|in|while|break|continue|import|from|as|config|migration|table|test|body|and|or|without|spawn|await|box)\\b"
        }
      ]
    },
    "definitions": {
      "patterns": [
        {
          "name": "meta.definition.fuse",
          "match": "^\\s*(fn|type|enum|config|service|app|migration|table|test)\\s+([A-Za-z_][A-Za-z0-9_]*(?:\\.[A-Za-z_][A-Za-z0-9_]*)*)",
          "captures": {
            "1": {"name": "keyword.control.fuse"},
            "2": {"name": "entity.name.type.fuse"}
          }
        },
        {
          "name": "meta.definition.app.fuse",
          "match": "^\\s*(app)\\s+(\"[^\"]*\")",
          "captures": {
            "1": {"name": "keyword.control.fuse"},
            "2": {"name": "string.quoted.double.fuse"}
          }
        }
      ]
    },
    "fields": {
      "patterns": [
        {
          "name": "meta.field.fuse",
          "match": "^\\s*([a-z_][A-Za-z0-9_]*)\\s*:",
          "captures": {
            "1": {"name": "variable.other.property.fuse"}
          }
        }
      ]
    },
    "functionCalls": {
      "patterns": [
        {
          "name": "meta.function-call.fuse",
          "match": "\\b([A-Za-z_][A-Za-z0-9_]*(?:\\.[A-Za-z_][A-Za-z0-9_]*)*)\\s*(\\()",
          "captures": {
            "1": {"name": "entity.name.function.fuse"},
            "2": {"name": "punctuation.section.arguments.begin.fuse"}
          }
        }
      ]
    },
    "errorTypes": {
      "patterns": [
        {
          "name": "meta.error-type.fuse",
          "match": "!\\s*([A-Za-z_][A-Za-z0-9_]*(?:\\.[A-Za-z_][A-Za-z0-9_]*)*)",
          "captures": {
            "0": {"name": "keyword.operator.fuse"},
            "1": {"name": "support.type.error.fuse"}
          }
        }
      ]
    },
    "types": {
      "patterns": [
        {
          "name": "storage.type.fuse",
          "match": "\\b(Int|Float|Bool|String|Id|Email|Bytes|Error|Option|Result|List|Map|Task|Range)\\b"
        }
      ]
    },
    "userTypes": {
      "patterns": [
        {
          "name": "support.type.user.fuse",
          "match": "\\b[A-Z][A-Za-z0-9_]*\\b"
        }
      ]
    },
    "constants": {
      "patterns": [
        {
          "name": "constant.language.fuse",
          "match": "\\b(true|false|null)\\b"
        }
      ]
    },
    "numbers": {
      "patterns": [
        {
          "name": "constant.numeric.fuse",
          "match": "\\b-?\\d+(?:\\.\\d+)?\\b"
        }
      ]
    },
    "namespaces": {
      "patterns": [
        {
          "match": "(?:^\\s*(?:type|enum|config)\\s+|[:!]|->)\\s*([A-Za-z_][A-Za-z0-9_]*)(?=\\.)",
          "captures": {
            "1": {"name": "entity.name.namespace.fuse"}
          }
        },
        {
          "match": "\\b(?:List|Map|Option|Result|Task|Range)\\s*<\\s*([A-Za-z_][A-Za-z0-9_]*)(?=\\.)",
          "captures": {
            "1": {"name": "entity.name.namespace.fuse"}
          }
        },
        {
          "match": "\\b([A-Za-z_][A-Za-z0-9_]*)(?=\\.[A-Za-z_][A-Za-z0-9_]*\\s*\\()",
          "captures": {
            "1": {"name": "entity.name.namespace.fuse"}
          }
        }
      ]
    },
    "memberAccess": {
      "patterns": [
        {
          "name": "meta.member.fuse",
          "match": "(?<=\\.)[A-Za-z_][A-Za-z0-9_]*",
          "captures": {
            "0": {"name": "variable.other.property.fuse"}
          }
        }
      ]
    }
  }
}
